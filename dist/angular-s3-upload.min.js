/*! angular-s3-upload - v0.0.3 - 2014-10-02
* Copyright (c) 2014 ; Licensed  */
"use strict";var ngS3Upload=angular.module("ngS3Upload",[]);ngS3Upload.directive("ngS3Upload",["$upload",function(a){return{replace:!0,scope:{label:"@",uploadHelper:"=",buttonClass:"@",index:"=",key:"@",path:"@",successCallback:"=",failureCallback:"=",progressCallback:"=",awsApi:"=",awsRegion:"@",bucket:"@"},templateUrl:"views/components/file-upload-button.html",link:function(a){a.awsApi.getAWSToken(a.key).then(function(b){a.aws={},a.aws.policy=b.policy,a.aws.signature=b.signature,a.aws.key=b.key},function(b){"undefined"!=typeof a.failureCallback&&a.failureCallback(b)})},controller:function(b){b.createUUID=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"==a?b:3&b|8;return c.toString(16)})},b.onFileSelect=function(c){for(var d=0;d<c.length;d++){var e=c[d],f=b.createUUID();b.upload=a.upload({url:"https://"+b.bucket+".s3.amazonaws.com/",method:"POST",data:{key:b.key+"/"+b.path+"/"+f,acl:"public-read","Content-Type":e.type,AWSAccessKeyId:b.aws.key,Policy:b.aws.policy,Signature:b.aws.signature},file:e}).progress(function(a){"undefined"!=typeof b.progressCallback.progress&&b.progressCallback(a)}).success(function(){var a="";"undefined"!=typeof b.awsRegion&&(a="https://s3-"+b.awsRegion+".amazonaws.com/");var c=a+b.bucket+"/"+b.key+"/"+b.path+"/"+f;"undefined"!=typeof b.successCallback&&b.successCallback(c)}).error(function(a,c,d,e){"undefined"!=typeof b.failureCallback&&b.failureCallback(a,c,d,e)})}}}}}]);